---
# --------Mysql replication related system variables --------------------------
# Will be copied to mysql_config_include_dir at replication setup

# Replication and Binary Logging Options and Variables
# Total 164
# https://dev.mysql.com/doc/refman/8.0/en/replication-options.html
# 0. server id and server uuid
# 1 Replication Master Options and Variables
# 2 Replication Slave Options and Variables
# 3 Binary Logging Options and Variables
# 4 Global Transaction ID Options and Variables
#=============================================================================

# 0. server id and server uuid--------------------
server_id: {{ server_id[inventory_hostname] }} # to set in group_vars/all.yml at server initiation
# server_uuid   # autogenerated based on server_id

# 1. System Variables Used on Replication Masters-------------------
# auto_increment_increment
# auto_increment_offset
# rpl_semi_sync_master_enabled
# rpl_semi_sync_master_timeout
# rpl_semi_sync_master_trace_level
# rpl_semi_sync_master_wait_for_slave_count
# rpl_semi_sync_master_wait_no_slave
# rpl_semi_sync_master_wait_point

# 2. System Variables Used on Replication Slaves--------------------------------
# Vivian set these:
master_info_repository: table
relay_log_info_repository: table
# I set these:
slave_sql_verify_checksum: 1

# Other variables in this category kept in defaults
# init_slave
# log_slow_slave_statements
# max_relay_log_size
# relay_log
# relay_log_basename
# relay_log_index
# relay_log_info_file
# relay_log_purge
# relay_log_recovery
# relay_log_space_limit
# report_host
# report_password
# report_port
# report_user
# rpl_read_size
# rpl_semi_sync_slave_enabled
# rpl_semi_sync_slave_trace_level
# rpl_stop_slave_timeout
# slave_allow_batching
# slave_checkpoint_group
# slave_checkpoint_period
# slave_compressed_protocol
# slave_exec_mode
# slave_load_tmpdir
# slave_max_allowed_packet
# slave_net_timeout
# slave_parallel_type=type
# slave_parallel_workers
# slave_pending_jobs_size_max
# slave_preserve_commit_order
# slave_rows_search_algorithms
# slave_skip_errors
# slave_transaction_retries
# slave_type_conversions
# sql_slave_skip_counter
# sync_master_info
# sync_relay_log
# sync_relay_log_info

# 3.System Variables Used with Binary Logging in replication
# Vivian set these:
binlog_format: ROW
log_bin: mysql-bin
log_bin_index: mysql-bin.index
max_binlog_size: 100M
expire_logs_days: 30
log_slave_updates: true
# I set these:
sync_binlog: 1






# Other variables in this category kept in defaults
# binlog_cache_size
# binlog_checksum
# binlog_direct_non_transactional_updates
# binlog_error_action
# binlog_expire_logs_seconds
# binlog_group_commit_sync_delay
# binlog_group_commit_sync_no_delay_count
# binlog_max_flush_queue_time
# binlog_order_commits
# binlog_row_image
# binlog_row_metadata
# binlog_row_value_options
# binlog_rows_query_log_events
# binlog_stmt_cache_size
# binlog_transaction_dependency_tracking
# binlog_transaction_dependency_history_size
# log_bin_basename
# log_bin_trust_function_creators
# log_bin_use_v1_row_events
# log_statements_unsafe_for_binlog
# master_verify_checksum  # might be userful for us, to add to my.cnf using blockinfile when set up replication
# max_binlog_cache_size
# max_binlog_stmt_cache_size
# original_commit_timestamp
# sql_log_bin
# transaction_write_set_extraction

# 4. System Variables Used with GTID Replication-----------------------
# Vivian kept this:
enforce_gtid_consistency: true
gtid_mode: ON

# Other variables in this category kept in defaults
# binlog_gtid_simple_recovery
# executed_gtids_compression_period
# gtid_executed
# gtid_executed_compression_period
# gtid_next
# gtid_owned
# simplified_binlog_gtid_recovery


{% if mysql_replication_master %}
# Replication
server-id = {{ mysql_server_id }}

{% if mysql_replication_role == 'master' %}
log_bin = mysql-bin
log-bin-index = mysql-bin.index
expire_logs_days = {{ mysql_expire_logs_days }}
max_binlog_size = {{ mysql_max_binlog_size }}
binlog_format = {{mysql_binlog_format}}

{% for db in mysql_databases %}
{% if db.replicate|default(1) %}
binlog_do_db = {{ db.name }}
{% else %}
binlog_ignore_db = {{ db.name }}
{% endif %}
{% endfor %}
{% endif %}

{% if mysql_replication_role == 'slave' %}
read_only
relay-log = relay-bin
relay-log-index = relay-bin.index
{% endif %}
{% endif %}
